---
title:  "JVM 이란?"
excerpt: "JVM"

categories:
  - java
  - 스터디
last_modified_at: 2020-05-21T08:06:00-05:00
---


# JVM 이란?

![image](https://user-images.githubusercontent.com/25449640/113674702-6f191200-96f5-11eb-80cb-fb35d588e0bd.png)

- JVM 은 자바 버추얼 머신의 약자입니다.

- JVM은 클래스(바이트코드)를 메모리에 로딩하는 클래스 로더, 바이트코드를 실행하는 실행 엔진, 런타임 데이터 영역으로 구성되어 있습니다.

- java 이전에 있었던 C 와 같은 프로그래밍 언어는 컴파일 된 파일이 OS 종속적이었습니다.

- 그래서 컴파일 된 OS 위에서만 구동되는 단점이 있었습니다. 새로운 OS 에서 작동 시키기 위해서는 다시 컴파일 했어야 하니까요.

- 그러나 java 는 JVM 을 이용해 위의 단점을 해결했습니다. 어떤 OS 든 JVM 만 설치 되어 있으면 그 위에서 java 컴파일러로 컴파일 된 클래스 파일을 실행시키면 되니까요.

- 동작과정은 다음과 같습니다.

- Hello.java 파일을 java 컴파일러로 컴파일을 하면 Hello.class 라는 클래스 파일이 생성됩니다. 이는 한줄 한줄이 1바이트라서 바이트코드 라고도 합니다.

- 이 바이트코드를 JVM 의 구성요소 중 한개인 클래스 로더가 런타임 메모리 영역으로 올립니다.

- 런타임 메모리 영역은 메소드가 저장되어 있는 메소드 영역, `new` 키워드를 통해 새로운 객체가 저장되는 `힙 영역`, 메소드의 호출,리턴 정보가 저장되는 `스택 영역`, 다음에 수행 될 명령어가 저장되어 있는 `PC 레지스터 영역`, 하드웨어 제어 등을 위해 다른 언어로 작성된 기능을 사용하고 기록하는 `네이티브 메소드 영역` 이 있습니다.

- `메소드 영역` 과 `힙 영역` 은 `모든 쓰레드가 공유` 하지만 `스택 영역` 과 `PC 레지스터 영역` , `네이티브 메소드 영역` 은 `개별 쓰레드` 할당됩니다.

- 이제 바이트코드가 JVM 의 런타임 메모리 영역에 올라간 바이트코드를 검사하여 변조되지 않았다면 JVM 의 다른 구성요소인 실행엔진에 의해 바이트코드가 한줄씩 수행됩니다. 이 과정에서 GC 의 작동과 쓰레드 동기화가 일어납니다.

- 실행엔진의 구성요소는 인터프리터, JIT 컴파일러, GC로 불리우는 가비지컬렉터가 있습니다.

- 가비지컬렉터는 힙 영역에 할당된 객체중 참조되지 않은 객체를 제거하는 역할을 합니다. 에덴, 서바이브0, 서바이브1 로 구성된 뉴 제네레이션 영역과 올드 제네레이션 영역으로 되어 있습니다.

- 막 객체가 등록되면 에덴 영역에 배치되고 계속 참조가 되어 살아남게 되면 서바이브0(또는 1) -> 올드 제네레이션 으로 이동하게 됩니다.


# JVM 의 구성요소

## 클래스 로더

- 런타임 시점에 바이트코드를 실행할 때 class 객체를 메모리(런타임 데이터 영역)에 생성하는 요소입니다.

## 실행 엔진

- 메모리에 로드 된 바이트코드를 실행하는 역할을 수행합니다.

- 클래스 로더를 통해 런타임 데이터 영역에 배치된 바이트코드는 실행엔진에 의해 실행 됩니다.

- 실행 엔진 내부적으로 인터프리터, JIT 컴파일러, 가비지 컬렉터가 있습니다.

### 가비지 컬렉터 (GC)

- 힙 영역에 생성된 객체들 중 참조되지 않은 객체들을 제거하는 역할을 수행합니다.

- GC 는 에덴, 서바이브0, 서바이브1 로 구성된 뉴 제네레이션과 올드 제네레이션 영역으로 나뉠 수 있습니다.

- 서바이브0 와 서바이브1 중 한가지 영역만 사용하며 꽉차면 올드 제네레이션으로 이동 시키고 다시 GC 가 일어납니다.

## 런타임 데이터 영역

- 메소드 영역 : 실행에 필요한 클래스들을 로드하여 저장. 내부적으로 메소드 영역과 상수 영역으로 나뉘어 저장합니다.

- 힙 영역 : 동적 메모리 할당 영역. GC 에 의해 관리 됨. 소스상 new 연산자로 객체가 만들 때 여기로 할당 됩니다.

- 스택 영역 : 프로그램 실행 중 발생하는 메소드 호출과 리턴에 대한 정보를 저장 합니다.

- PC 레지스터 영역 : 다음에 실행할 명령어에 대한 정보를 저장 합니다. (프로그램 카운트)

- 네이티브 메소드 영역 : 하드웨어를 제어하는 기능등을 위해 C 언어와 같은 다른 언어의 기능을 사용하고 기록하기 위한 영역입니다.