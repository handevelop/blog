---
title:  "쿼리 실행 계획?"
excerpt: "EXPLAIN"

categories:
  - 스터디
  - DB
tag:
  - DB
  - MySQL
last_modified_at: 2021-05-12T08:22:00-05:00
---



# 실행 계획이란?

- 개발한 소스에서 정적 분석기를 통해 특별한 문제가 발견되지 않았음에도 특정 API 가 느려질때가 있다.

- 이 때 쿼리가 느리다고 의심을 해볼 수 있다. 실행계획을 확인해 보면서 쿼리를 개선해 나갈 수 있다.

- `MySQL` 은 `EXPLAIN` 명령어로 `SELECT` 쿼리의 실행계획을 산출할 수 있다.

## 실행 계획 상세 내용

- `ID` : SELECT 쿼리별로 부여되는 식별자

- `SELECT_TYPE` : 쿼리가 어떤 타입의 쿼리인지 표시

- `TYPE` : 테이블의 레코드를 어떤 방식으로 읽었는가를 표시

- `POSSIBLE_KEYS` : 옵티마이저가 후보로 선정했던 인덱스 목록을 표시

- `KEY` : 옵티마이저가 선정한 실행계획에서 사용하는 인덱스를 표시

- `KEY_LEN` : 인덱스 키 길이가 몇 바이트 인지를 표시

- `REF` : `TYPE` 이 ref 방식이었다면 참조 조건으로 어떤 값이 제공됐는지 표시

- `ROWS` : 디스크로부터 읽어야 할 레코드 수를 표시

- `EXTRA` : 성능에서 가장 중요한 컬럼. Using index, Using where 등의 내용이 표기된다.


# Using index (feat.커버링 인덱스)

- 실행계획 수행 후 Extra 항목에 `Using index` 항목이 있으면 이 쿼리는 인덱스를 탄다는 의미이다.

- 이 때 Extra 항목에 `Using where` 없이 `Using index` 만 있다면 이것은 `커버링 인덱스` 라 불리운다.

- 커버링 인덱스란 원하는 데이터를 인덱스만으로도 추출할 수 있는 인덱스를 의미한다. 즉 메모리 영역에서 B-Tree 스캔만으로 데이터를 가져올 수 있기 때문에 성능이 매우 뛰어나다.


# Using index condition ? (feat.MySQL)

![image](https://user-images.githubusercontent.com/25449640/118000569-e428d880-b380-11eb-9e38-3e1719317a5e.png)


- 실행계획 수행 후 Extra 항목에서 `Using index condition` 항목이 있다면 이것은 `인덱스 컨디션 푸시다운` 이 작동된 것이다.

- `인덱스 컨디션 푸시다운` 은 MySQL 5.6 이상의 버전에서 추가되었다.

- MySQL 5.5 이하의 버전에서는 인덱스의 필드 일부를 범위 조건을 사용하여 조회하면 인덱스가 적용되지 않기 때문에 `Using where` 이 된다.

- 하지만 MySQL 5.6 이상의 버전에서는 인덱스 범위 조건으로 인덱스를 사용할 수 없는 경우에도 인덱스에 포함된 필드라면 `스토리지 엔진(InnoDB)` 으로 인덱스 조건을 전달하여 데이터를 걸러낸 뒤 `MySQL 엔진` 으로 데이터를 갖고 올 수 있게 되었다.

- 인덱스 조건을 `스토리지 엔진` 으로 넘겨주기 때문에 `인덱스 컨디션 푸시다운` 이란 이름이 생겼다.